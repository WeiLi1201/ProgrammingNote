{"diagram":{"image":{"x":0,"width":200,"y":0,"pngdata":"iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVR4nO3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8GXHmAAFMgHIEAAAAAElFTkSuQmCC","height":200},"elements":{"leftChildren":[],"children":[{"parent":"root","children":[{"parent":"4877e90e17c1","number":{"level":"1","type":"2"},"children":[{"parent":"ae9b4a9605a3","children":[{"parent":"9650bceaddd8","children":[],"id":"d45a3b98cb5b","title":"生成函数 -&gt; 版本集成函数 -&gt; 特征群的生成函数 &nbsp;-&gt; 工具函数<br>"}],"id":"9650bceaddd8","title":"调用关系"},{"parent":"ae9b4a9605a3","children":[{"parent":"917ebdc12c65","children":[],"id":"67f0cd5b4be0","title":"# 计算折扣率&nbsp;get_discount_rate(s)<br>"},{"parent":"917ebdc12c65","children":[],"id":"fffb359c1c53","title":"# 获取是否满减 &nbsp;get_if_fd(s)<br>"},{"parent":"917ebdc12c65","children":[],"id":"50edd15267e4","title":"# 获取满减的条件 &nbsp;get_full_value(s)<br>"},{"parent":"917ebdc12c65","children":[],"id":"9d6921e9ea58","title":"# 获取满减的优惠 &nbsp;get_reduction_value(s)"},{"parent":"917ebdc12c65","children":[{"parent":"8f10f9dcc14b","children":[],"id":"a523aaa9499a","title":"#计算日期间隔&nbsp;&nbsp;<br>def&nbsp;add_day_gap(df):<br>"}],"id":"8f10f9dcc14b","title":"# 获取日期间隔，输入内容为Date_received:Date &nbsp;get_day_gap(s)"},{"parent":"917ebdc12c65","children":[{"parent":"2b11d0e68947","children":[],"id":"e27c71d53612","title":"#获取label<br>def&nbsp;add_label(df):<br>"}],"id":"2b11d0e68947","title":"#获取Label，输入内容为Date:Date_received &nbsp;get_label(s)"},{"parent":"917ebdc12c65","children":[],"id":"60ca547788dc","title":"#增加折扣相关特征 &nbsp;add_discount(df)"},{"parent":"917ebdc12c65","children":[],"id":"9ccb821348c1","title":"def&nbsp;get_day_gap_before(s):"},{"parent":"917ebdc12c65","children":[],"id":"08c4119ce60a","title":"def&nbsp;get_day_gap_after(s):"},{"parent":"917ebdc12c65","children":[{"parent":"dcc354c15a10","children":[],"id":"c2e696a20364","title":"def&nbsp;add_agg_feature_names"}],"id":"dcc354c15a10","title":"统计特征处理函数: &nbsp;def&nbsp;add_agg_feature &nbsp;名称按照keyword+'_'+value_col+'_'+op&nbsp;自动增加<br>"},{"parent":"917ebdc12c65","children":[],"id":"60d6b009d838","title":"统计特征处理函数 #&nbsp;增加一个count特征 &nbsp;def&nbsp;add_count_new_feature<br>"}],"collapsed":true,"id":"917ebdc12c65","title":"工具函数层"},{"parent":"ae9b4a9605a3","children":[{"parent":"c18451398d0a","children":[{"parent":"7c5d48109a8a","children":[],"id":"b7b5a0d81c36","title":"#删除重复行数据<br>"},{"parent":"7c5d48109a8a","children":[{"parent":"e1c588593a23","children":[],"id":"5d6ea0ca431c","title":"#使用了优惠券消费的商品，正样本"}],"id":"e1c588593a23","title":"#卖出的商品"},{"parent":"7c5d48109a8a","children":[],"id":"616962418363","title":"#商品的优惠券的总数量"},{"parent":"7c5d48109a8a","children":[],"id":"424392a1b107","title":"#商品销量和距离的关系"},{"parent":"7c5d48109a8a","children":[],"id":"6ed498fded5f","title":"#将数据中的NaN用0来替换"},{"parent":"7c5d48109a8a","children":[],"id":"74e10cf3985e","title":"#优惠券的使用率"},{"parent":"7c5d48109a8a","children":[],"id":"cd58fc5659bc","title":"卖出商品中使用优惠券的占比"}],"id":"7c5d48109a8a","title":"#&nbsp;获取商家相关特征<br>def&nbsp;get_merchant_feature<br>"},{"parent":"c18451398d0a","children":[{"parent":"1bcb28634d10","children":[],"id":"e9fe5c978946","title":"#客户一共买的商品"},{"parent":"1bcb28634d10","children":[],"id":"af6bdc38b8de","title":"#客户使用优惠券线下购买距离商店的距离统计最大，最小，平均，中位值"},{"parent":"1bcb28634d10","children":[],"id":"94c9ef293ee6","title":"#客户使用优惠券购买的次数"},{"parent":"1bcb28634d10","children":[],"id":"4fda0f20bec9","title":"#客户使购买的总次数"},{"parent":"1bcb28634d10","children":[],"id":"224149eb6986","title":"#客户收到优惠券的总数"},{"parent":"1bcb28634d10","children":[],"id":"7ded9d2d1178","title":"#客户从收优惠券到消费的时间间隔，统计最大，最小，平均，中位值"}],"id":"1bcb28634d10","title":"#&nbsp;获取用户相关特征<br>def&nbsp;get_user_feature(<br>"},{"parent":"c18451398d0a","children":[{"parent":"9ec1c0e834f8","children":[],"id":"dba3047882c6","title":"#一个客户在一个商家一共买的次数"},{"parent":"9ec1c0e834f8","children":[],"id":"690686ce6a8c","title":"#一个客户在一个商家一共收到的优惠券"},{"parent":"9ec1c0e834f8","children":[],"id":"308d91d43d29","title":"#一个客户在一个商家使用优惠券购买的次数"},{"parent":"9ec1c0e834f8","children":[],"id":"406454a6bb07","title":"#一个客户在一个商家浏览的次数"},{"parent":"9ec1c0e834f8","children":[],"id":"4387ec8e9772","title":"#一个客户在一个商家没有使用优惠券购买的次数"}],"id":"9ec1c0e834f8","title":"#&nbsp;获取用户与商家的交互特征<br>def&nbsp;get_user_merchant_feature<br>"},{"parent":"c18451398d0a","children":[{"parent":"81798b334bb9","children":[],"id":"0baaf54f81ba","title":"计算接受了优惠券的数量,apply是合并"},{"parent":"81798b334bb9","children":[],"id":"f14e6e481eac","title":"相同的用户接收相同的优惠券在接收时间上用‘：’连接上第n次接受优惠券的时间"},{"parent":"81798b334bb9","children":[],"id":"a81715755682","title":"最近接收时间和最远接受时间"},{"parent":"81798b334bb9","children":[],"id":"61334497185a","title":"一个用户所接收到的所有优惠券的数量"},{"parent":"81798b334bb9","children":[],"id":"ed83702c2f6c","title":"一个用户不同时间所接收到不同优惠券的数量"},{"parent":"81798b334bb9","children":[],"id":"02352908cbee","title":"#一个用户不同优惠券&nbsp;的接受时间"}],"id":"81798b334bb9","title":"#提取穿越特征<br>def&nbsp;get_leakage_feature(<br>"}],"collapsed":true,"id":"c18451398d0a","title":"各个特征群的生成函数层"},{"parent":"ae9b4a9605a3","children":[{"parent":"e8bcd47de981","children":[{"parent":"e4e752e96275","children":[],"id":"6f01e1cd8f9d","title":"add_discount"},{"parent":"e4e752e96275","children":[],"id":"9148816d1494","title":"add_label"}],"id":"e4e752e96275","title":"# f1 特征1只有最基础的特征<br>"},{"parent":"e8bcd47de981","children":[{"parent":"1bb3452e1f90","children":[],"id":"c57d6b3cef3a","title":"get_merchant_feature"},{"parent":"1bb3452e1f90","children":[],"id":"dd1105ab537a","title":"add_discount"},{"parent":"1bb3452e1f90","children":[],"id":"39c25a7ffb72","title":"get_user_feature"},{"parent":"1bb3452e1f90","children":[],"id":"c9030308d441","title":"get_user_merchant_feature"},{"parent":"1bb3452e1f90","children":[],"id":"b54bed7b7c2f","title":"add_label(result)"}],"id":"1bb3452e1f90","title":"#f2 &nbsp;特征2增加Merchant,user特征<br>"},{"parent":"e8bcd47de981","children":[{"parent":"6a3e82b338ba","children":[],"id":"93421240a594","title":"add_discount"},{"parent":"6a3e82b338ba","children":[],"id":"c6735c3d66e2","title":"get_merchant_feature"},{"parent":"6a3e82b338ba","children":[],"id":"825bc742a049","title":"get_user_feature"},{"parent":"6a3e82b338ba","children":[],"id":"1173abba7aa0","title":"get_user_merchant_feature"},{"parent":"6a3e82b338ba","children":[],"id":"f3a64d957be7","title":"get_leakage_feature"},{"parent":"6a3e82b338ba","children":[],"id":"ade276b59f18","title":"add_label(result)"}],"id":"6a3e82b338ba","title":"#f3 &nbsp;#特征3增加leakage特征<br>"}],"collapsed":true,"id":"e8bcd47de981","title":"版本集成层"},{"parent":"ae9b4a9605a3","children":[{"parent":"7a162c12d2bd","children":[{"parent":"524ef11e4238","children":[],"id":"9a1dc64603f7","title":"normal_feature_generate(feature_function)"},{"parent":"524ef11e4238","children":[{"parent":"3baabf8490e0","children":[],"id":"05134fd2900a","title":"#f1<br>normal_feature_generate(f1)<br>"}],"id":"3baabf8490e0","title":"feature_function 即 f1<br>"}],"id":"524ef11e4238","title":"生成不滑窗特征<br>特征名：训练集：train_版本函数，测试集:test_版本函数<br>"},{"parent":"7a162c12d2bd","children":[{"parent":"8890133714ff","children":[],"id":"0e9feba706b6","title":"slide_feature_generate(feature_function)"},{"parent":"8890133714ff","children":[{"parent":"d27879aeb69a","children":[],"id":"c409b39754ba","title":"#sf2<br>slide_feature_generate(f2)<br>#sf3<br>slide_feature_generate(f3)<br>"}],"id":"d27879aeb69a","title":"feature_function 即 f2 f3<br>"}],"id":"8890133714ff","title":"#生成滑窗特征<br>#&nbsp;特征名：训练集：train_s版本函数，测试集:test_s版本函数<br>"},{"parent":"7a162c12d2bd","children":[],"id":"72db10517852","title":"生成的特征中，sf3版本是特征最全面的特征。f1,&nbsp;sf2是简单版，主要是做对比使用。这个代码结构很容易做新版本的特征，大家可以自己进行尝试。后续会在sf3的基础上对特征数据进行分析，优化，最后生成最终的特征。"}],"collapsed":true,"id":"7a162c12d2bd","title":"特征生成层"}],"id":"ae9b4a9605a3","title":"特征工程"},{"parent":"4877e90e17c1","children":[{"parent":"1ea4501e5cc8","children":[{"parent":"724c04ea97a7","children":[{"parent":"68dfb09c93de","children":[],"id":"364fc48a514e","title":"id_col_names"},{"parent":"68dfb09c93de","children":[],"id":"93ef0ca44eca","title":"target_col_name"},{"parent":"68dfb09c93de","children":[],"id":"b1054b240a9d","title":"id_target_cols"}],"id":"68dfb09c93de","title":"全局参数"},{"parent":"724c04ea97a7","children":[{"parent":"5cadfabbf93d","children":[],"id":"2641b137700f","title":"#返回ID列<br>def&nbsp;get_id_df<br>"},{"parent":"5cadfabbf93d","children":[],"id":"118b17dd5526","title":"#返回Target列<br>def&nbsp;get_target_df<br>"},{"parent":"5cadfabbf93d","children":[],"id":"5388e1945f7f","title":"#返回特征列<br>def&nbsp;get_predictors_df<br>"},{"parent":"5cadfabbf93d","children":[],"id":"85d899330f96","title":"#按特征名读取训练集<br>def&nbsp;read_featurefile_train<br>"},{"parent":"5cadfabbf93d","children":[],"id":"1e0b30ad2fb6","title":"#按特征名读取测试集<br>def&nbsp;read_featurefile_test<br>"},{"parent":"5cadfabbf93d","children":[],"id":"5b8500264844","title":"#按特征名读取数据<br>def&nbsp;read_data<br>"}],"id":"5cadfabbf93d","title":"数据读取工具函数"},{"parent":"724c04ea97a7","children":[],"id":"863c96ca8c3b","title":"#对SF3（最全的一版）版本特征进行分析"}],"collapsed":true,"id":"724c04ea97a7","title":"特征读取"},{"parent":"1ea4501e5cc8","children":[],"id":"780e5b581a21","title":"特征数据总览"},{"parent":"1ea4501e5cc8","children":[{"parent":"1e1d57064952","children":[],"id":"7ec818b70773","title":"发现异常分布"}],"id":"1e1d57064952","title":"查看数据分布"},{"parent":"1ea4501e5cc8","children":[],"id":"d68dbf20111f","title":"查看特征相关性"},{"parent":"1ea4501e5cc8","children":[],"id":"b5ccd3f86ca5","title":"相关性分析"}],"id":"1ea4501e5cc8","title":"特征分析"},{"parent":"4877e90e17c1","note":"未总结","children":[{"parent":"e2240a5e5201","children":[],"id":"85949d3ca943","title":"归一化"},{"parent":"e2240a5e5201","children":[],"id":"7d5e907255fa","title":"特征技巧"}],"id":"e2240a5e5201","title":"特征后续处理"}],"collapsed":true,"id":"4877e90e17c1","title":"特征工程","icons":[{"color":"rgb(255, 159, 26)","name":"priority","index":"0","text":"&#xe69a"}]},{"parent":"root","children":[{"parent":"d7f2e3afdd60","children":[{"parent":"ea5eeb8818d3","children":[{"parent":"8f73a41224fc","children":[],"id":"93da7e4e0939","title":"所有sklearn集成的算法/工具库<br>"}],"id":"8f73a41224fc","title":"引入代码包"},{"parent":"ea5eeb8818d3","children":[{"parent":"b2247b55dd98","children":[],"id":"f37bef5839aa","title":"id_col_name/target_col_name/id_target_cols/myeval<br>"},{"parent":"b2247b55dd98","children":[{"parent":"ab2297167b38","children":[],"id":"fbe4b98217b5","title":"featurepath &nbsp;resultpath &nbsp;tmppath"}],"id":"ab2297167b38","title":"目录定义<br>"}],"id":"b2247b55dd98","title":"全局参数"},{"parent":"ea5eeb8818d3","children":[],"id":"6e8389b558b5","title":"特征读取工具函数"}],"id":"ea5eeb8818d3","title":"准备工作"},{"parent":"d7f2e3afdd60","children":[{"parent":"e39bb5cfb905","children":[],"id":"1ee723f22342","title":"#&nbsp;将特征归一化<br>def&nbsp;standize_df<br>"},{"parent":"e39bb5cfb905","children":[],"id":"34e05d1e1469","title":"部分整合在sklearn的分类算法<br>def&nbsp;get_sklearn_model<br>"},{"parent":"e39bb5cfb905","children":[],"id":"fcad92e7084f","title":"#画学习曲线<br>def&nbsp;plot_learning_curve<br>"},{"parent":"e39bb5cfb905","children":[],"id":"007fb8778d86","title":"#画算法的学习曲线,为加快画图速度，最多选20%数据<br>def&nbsp;plot_curve_single<br>"},{"parent":"e39bb5cfb905","children":[],"id":"7fba9280d12a","title":"#性能评价函数<br>#&nbsp;coupon平均auc计算<br>def&nbsp;myauc<br>"},{"parent":"e39bb5cfb905","children":[],"id":"fb12223dad31","title":"# 测试模型代码<br>#按照日期分割<br>def&nbsp;test_model<br>"}],"collapsed":true,"id":"e39bb5cfb905","title":"模型训练代码"},{"parent":"d7f2e3afdd60","children":[{"parent":"231a0be1aa5c","children":[{"parent":"196d2adf418f","children":[],"id":"2e4c1c0940ce","title":"归一化"}],"id":"196d2adf418f","title":"数据读取"},{"parent":"231a0be1aa5c","children":[{"parent":"e5357c67523d","children":[{"parent":"82f40a6f8e58","children":[],"id":"c204e76e87ad","title":"逻辑回归"},{"parent":"82f40a6f8e58","children":[],"id":"eb68c39a384d","title":"朴素贝叶斯"},{"parent":"82f40a6f8e58","children":[],"id":"9068a0096160","title":"决策树"},{"parent":"82f40a6f8e58","children":[],"id":"d8a8f1230717","title":"随机森林"},{"parent":"82f40a6f8e58","children":[],"id":"ca410163ec23","title":"lightgbm<br>"},{"parent":"82f40a6f8e58","children":[],"id":"416e7fcef80e","title":"xgboost"}],"id":"82f40a6f8e58","title":"哪些模型"},{"parent":"e5357c67523d","children":[{"parent":"390f07862a43","children":[],"id":"518a02939cf5","title":"test_model<br>"},{"parent":"390f07862a43","children":[],"id":"fb60731b3b3b","title":"plot_curve_single<br>"}],"id":"390f07862a43","title":"怎么做"},{"parent":"e5357c67523d","children":[],"id":"957f591cc988","title":"先跑通<br>"}],"collapsed":true,"id":"e5357c67523d","title":"使用不同模型试验"}],"collapsed":true,"id":"231a0be1aa5c","title":"使用简单特征f1训练<br>"},{"parent":"d7f2e3afdd60","children":[{"parent":"c91386577ed4","children":[{"parent":"108239146352","children":[],"id":"507a61ecfd84","title":"f2版本 &nbsp;read_data('sf2')<br>f1版本&nbsp;&nbsp;read_data('sf1')<br>f3版本&nbsp;&nbsp;read_data('sf3')<br>"}],"id":"108239146352","title":"读取数据"},{"parent":"c91386577ed4","children":[{"parent":"eb376a1245d7","children":[],"id":"774d8c4823b0","title":"print('特征f1逻辑回归成绩')<br>test_model(train_f1,'LR')<br>print('特征sf2逻辑回归成绩')<br>test_model(train_f2,'LR')<br>print('特征sf3逻辑回归成绩')<br>test_model(train_f3,'LR')<br>"},{"parent":"eb376a1245d7","children":[],"id":"135dcb50184a","title":"print('特征f1朴素贝叶斯成绩')<br>test_model(train_f1,'NB')<br>print('特征sf2朴素贝叶斯成绩')<br>test_model(train_f2,'NB')<br>print('特征sf3朴素贝叶斯成绩')<br>test_model(train_f3,'NB')<br>"},{"parent":"eb376a1245d7","children":[{"parent":"3507acb7a925","children":[],"id":"a6d4e1532678","title":"发现特征f2比特征f1的结果好很多，这是因为特征2使用滑窗方案"},{"parent":"3507acb7a925","children":[],"id":"7939c2a19cc3","title":"而特征3比特征又有了很大的提高，这是因为特征3增加了穿越特征。"}],"id":"3507acb7a925","title":"分析结果"}],"id":"eb376a1245d7","title":"对比分析"},{"parent":"c91386577ed4","children":[{"parent":"3329b861560a","children":[],"id":"9c05c712ab41","title":"#预测函数<br>def&nbsp;classifier_df_simple<br>"},{"parent":"3329b861560a","children":[],"id":"aa8248e964ba","title":"#输出结果函数<br>def&nbsp;output_predicted<br>"}],"id":"3329b861560a","title":"结果输出"}],"collapsed":true,"id":"c91386577ed4","title":"用不同的特征训练，对比分析"}],"id":"d7f2e3afdd60","title":"模型训练","icons":[{"color":"rgb(255, 102, 0)","name":"priority","index":"1"}]},{"parent":"root","number":{"level":"1","type":"2"},"children":[{"parent":"7c82e6ce8222","number":{"level":"1","type":"1"},"children":[{"parent":"2a0a09375d5d","children":[],"id":"61418c41f1f9","title":"评价指标"},{"parent":"2a0a09375d5d","children":[],"id":"bf86b9307e6a","title":"验证方式"},{"parent":"2a0a09375d5d","children":[{"parent":"d615a3212fb7","children":[],"id":"9528f70f9e7e","title":"学习曲线"},{"parent":"d615a3212fb7","children":[],"id":"eb3203a9d401","title":"结果分析"}],"id":"d615a3212fb7","title":"模型比较"},{"parent":"2a0a09375d5d","children":[],"id":"ffe8e02e7e88","title":"模型选择"},{"parent":"2a0a09375d5d","children":[],"id":"7f913f044499","title":"模型调参"}],"id":"2a0a09375d5d","title":"整体思路"},{"parent":"7c82e6ce8222","children":[{"parent":"d049c13a9f41","children":[],"id":"e5b0caa7ea91","title":"引入代码包"},{"parent":"d049c13a9f41","children":[],"id":"671fe6b230e8","title":"全局参数"},{"parent":"d049c13a9f41","children":[],"id":"67929ee4c438","title":"特征读取及工具函数"}],"id":"d049c13a9f41","title":"准备工作"},{"parent":"7c82e6ce8222","children":[{"parent":"664512f8ff59","note":"#本赛题目标是预测投放的优惠券是否核销。\n#针对此任务及一些相关背景知识，使用优惠券核销预测的平均AUC（ROC曲线下面积）作为评价标准。 \n#即对每个优惠券coupon_id单独计算核销预测的AUC值，再对所有优惠券的AUC值求平均作为最终的评价标准。\n# coupon平均auc计算","children":[],"id":"b9a7389b9ebe","title":"#性能评价函数<br>def&nbsp;myauc<br>"},{"parent":"664512f8ff59","note":"预测方式，因为要的结果是购买的几率，不能直接用Predict因为这样会直接返回0,1,而要用predict_proba，它会返回每个类别的可能行，取其中为1的列即可","children":[],"id":"638894e2cf88","title":"返回每个类别的可能行，取其中为1的列<br>"}],"collapsed":true,"id":"664512f8ff59","title":"评价指标"},{"parent":"7c82e6ce8222","children":[{"parent":"fc39b87971ac","children":[{"parent":"6c49033afc2a","children":[],"id":"cab9ee0025f9","title":"简单交叉验证F1"},{"parent":"6c49033afc2a","children":[],"id":"3ed31171f570","title":"#&nbsp;简单交叉验证&nbsp;F3"}],"id":"6c49033afc2a","title":"简单交叉验证"},{"parent":"fc39b87971ac","children":[],"id":"40f2f7e63d8e","title":"K折交叉验证&nbsp;K-fold&nbsp;CV"},{"parent":"fc39b87971ac","children":[],"id":"53e083edfdb6","title":"留P法&nbsp;LPO&nbsp;CV"},{"parent":"fc39b87971ac","children":[{"parent":"cbbe80f1b040","children":[],"id":"3ab6cf640212","title":"本赛题正负样本分布不均匀。而StratifiedKFold&nbsp;分层采样交叉切分"}],"id":"cbbe80f1b040","title":"StratifiedKFold<br>"}],"collapsed":true,"id":"fc39b87971ac","title":"验证方式"},{"parent":"7c82e6ce8222","children":[{"parent":"155c5bdef297","children":[{"parent":"742991c322a6","children":[],"id":"56b1125dd23e","title":"print&nbsp;('特征f1,&nbsp;不同模型5折训练Score：')<br>classifier_df_score(train,'NB',5)<br>classifier_df_score(train,'LR',5)<br>classifier_df_score(train,'RF',5)<br>classifier_df_score(train,'LGB',5)<br>"},{"parent":"742991c322a6","children":[],"id":"48b0ebd960ae","title":"print&nbsp;('特征f3,&nbsp;不同模型5折训练Score：')<br>classifier_df_score(train,'NB',5)<br>classifier_df_score(train,'LR',5)<br>classifier_df_score(train,'RF',5)<br>classifier_df_score(train,'LGB',5)<br>"}],"id":"742991c322a6","title":"线下评测分数<br>不同模型不同特征<br>"},{"parent":"155c5bdef297","children":[{"parent":"52597a58ca7a","children":[],"id":"5e4241ee8801","title":"#画学习曲线<br>def&nbsp;plot_learning_curve<br>"},{"parent":"52597a58ca7a","children":[],"id":"fbfac0106cb9","title":"#画算法的学习曲线,为加快画图速度，最多选20%数据<br>def&nbsp;plot_curve_single<br>"}],"id":"52597a58ca7a","title":"绘制不同的学习曲线"},{"parent":"155c5bdef297","children":[{"parent":"63a3bb915a4f","children":[],"id":"bd969236c8cb","title":"可以发现在特征集f1上，评测分普遍比较低，是欠拟合。&nbsp;在特征集f3上决策树和随机森林都表现出过拟合。LGB表现比较好"}],"id":"63a3bb915a4f","title":"分析可视化和score数据结果"}],"id":"155c5bdef297","title":"模型比较"},{"parent":"7c82e6ce8222","children":[{"parent":"5b17407e943a","children":[],"id":"5b83610e9036","title":"F3 + 随机森林<br>"},{"parent":"5b17407e943a","children":[],"id":"ba57e6135a91","title":"F3 + LGB<br>"}],"id":"5b17407e943a","title":"模型选择"},{"parent":"7c82e6ce8222","children":[{"parent":"cd9e082765a0","children":[],"id":"6ad805373713","title":"模型超参空间及调参"},{"parent":"cd9e082765a0","children":[],"id":"f73b9833c808","title":"穷举网格 GridSearchCV"},{"parent":"cd9e082765a0","children":[],"id":"a9b44c94f954","title":"随机参数优化 RandomizedSearchCV"},{"parent":"cd9e082765a0","note":"LightGBM 调参次序：\n第一步：学习率和迭代次数\n第二步：确定max_depth和num_leaves\n第三步：确定min_data_in_leaf和max_bin in\n第四步：确定feature_fraction、bagging_fraction、bagging_freq\n第五步：确定lambda_l1和lambda_l2\n第六步：确定 min_split_gain\n第七步：降低学习率，增加迭代次数，验证模型","children":[{"parent":"1e476f03ef52","children":[{"parent":"396d6f464609","children":[],"id":"c25508b70e9e","title":"{‘learning_rate’: [0.1, 0.15,0.2 ]}<br>parameters&nbsp;=&nbsp;{'n_estimators':[100,150,175,200,225,250]}<br>"}],"id":"396d6f464609","title":"1. 学习率和迭代次数"},{"parent":"1e476f03ef52","children":[{"parent":"20cf3fcb38d3","children":[],"id":"664efe547277","title":"parameters={'max_depth':&nbsp;range(4,8,1),&nbsp;'num_leaves':range(10,&nbsp;150,&nbsp;10)}"}],"id":"20cf3fcb38d3","title":"#第二步：确定max_depth和num_leaves<br>#n_estimators=200<br>"},{"parent":"1e476f03ef52","children":[{"parent":"0b7415fe12f5","children":[],"id":"2c5746b95118","title":"parameters={'max_bin':&nbsp;range(100,500,50),'min_data_in_leaf':range(100,150,10)}"}],"id":"0b7415fe12f5","title":"#第三步：确定min_data_in_leaf和max_bin&nbsp;in<br>#已经确认内容：<br>#n_estimators=200<br>#{'max_depth':&nbsp;6,&nbsp;'num_leaves':&nbsp;40}<br>"},{"parent":"1e476f03ef52","children":[{"parent":"03b0e8d87f96","children":[],"id":"fd5239ea3b04","title":"parameters={&nbsp;&nbsp;'feature_fraction':&nbsp;[0.6,0.7,0.8,0.9,1.0],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'bagging_fraction':&nbsp;[0.6,0.7,0.8,0.9,1.0],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'bagging_freq':&nbsp;range(0,10,2)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>"}],"id":"03b0e8d87f96","title":"#第四步：确定feature_fraction、bagging_fraction、bagging_freq&nbsp;<br>#已经确认内容：<br>#n_estimators=200<br>#{'max_depth':&nbsp;6,&nbsp;'num_leaves':&nbsp;40}<br>#{'max_bin':&nbsp;400,&nbsp;'min_data_in_leaf':&nbsp;120}<br>"},{"parent":"1e476f03ef52","children":[{"parent":"7662edaa8ec6","children":[],"id":"b545762e99d4","title":"parameters={'lambda_l1':&nbsp;[1e-5,1e-3,1e-1,0.0,0.1,0.3,0.5,0.7,0.9,1.0],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'lambda_l2':&nbsp;[1e-5,1e-3,1e-1,0.0,0.1,0.3,0.5,0.7,0.9,1.0]<br>}<br>"}],"id":"7662edaa8ec6","title":"#第五步：确定lambda_l1和lambda_l2<br>#已经确认内容：<br>#n_estimators=200<br>#{'max_depth':&nbsp;6,&nbsp;'num_leaves':&nbsp;40}<br>#{'max_bin':&nbsp;400,&nbsp;'min_data_in_leaf':&nbsp;120}<br>#{'bagging_fraction':&nbsp;0.9,&nbsp;'bagging_freq':&nbsp;4,&nbsp;'feature_fraction':&nbsp;0.6}<br>"},{"parent":"1e476f03ef52","children":[{"parent":"cec26f27288b","children":[],"id":"1a7f408999be","title":"parameters={'min_split_gain':[0.0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0]}"}],"id":"cec26f27288b","title":"#第六步：确定&nbsp;min_split_gain<br>#已经确认内容：<br>#n_estimators=200<br>#{'max_depth':&nbsp;6,&nbsp;'num_leaves':&nbsp;40}<br>#{'max_bin':&nbsp;400,&nbsp;'min_data_in_leaf':&nbsp;120}<br>#{'bagging_fraction':&nbsp;0.9,&nbsp;'bagging_freq':&nbsp;4,&nbsp;'feature_fraction':&nbsp;0.6}<br>#{'lambda_l1':&nbsp;1e-05,&nbsp;'lambda_l2':&nbsp;1e-05}<br>"},{"parent":"1e476f03ef52","children":[],"id":"78fa4065d9e9","title":"#&nbsp;第七步：降低学习率，增加迭代次数，验证模型<br>#已经确认内容：<br>#n_estimators=200<br>#{'max_depth':&nbsp;6,&nbsp;'num_leaves':&nbsp;40}<br>#{'max_bin':&nbsp;400,&nbsp;'min_data_in_leaf':&nbsp;120}<br>#{'bagging_fraction':&nbsp;0.9,&nbsp;'bagging_freq':&nbsp;4,&nbsp;'feature_fraction':&nbsp;0.6}<br>#{'lambda_l1':&nbsp;1e-05,&nbsp;'lambda_l2':&nbsp;1e-05}<br>#{'min_split_gain':&nbsp;0.0}<br>"}],"collapsed":true,"id":"1e476f03ef52","title":"LightGBM调参"},{"parent":"cd9e082765a0","children":[],"id":"adfc9c2b9755","title":"绘制验证曲线"},{"parent":"cd9e082765a0","children":[],"id":"4d8d9b20648e","title":"比发现调参后的结果比默认参数有所提高，不过不是高很多，比不上特征对结果的影响。而且因为调参只能再测试集上作，有的时候调参造成过拟，调参后线上成绩可能反而会下降。所以调参一般都是在比赛后期再做，前期主要是特征和模型的选择。"}],"id":"cd9e082765a0","title":"模型调参"}],"collapsed":true,"id":"7c82e6ce8222","title":"模型验证及优化","icons":[{"color":"rgb(255, 175, 56)","name":"priority","index":"2"}]}],"root":true,"theme":"simple_line2","id":"root","title":"O2O案例","version":575,"structure":"mind_right"}},"meta":{"exportTime":"2022-05-18 16:41:44","member":"","diagramInfo":{"creator":"","created":"","modified":"","title":"","category":""},"id":"","type":"ProcessOn Schema File","version":"1.0"}}